<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3-OVER MATCH | OFFICIAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; text-align: center; margin: 0; overflow: hidden; }
        .screen { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .hidden { display: none; }
        select { background: #000; color: #0f0; border: 1px solid #0f0; padding: 10px; font-size: 1.1rem; width: 280px; margin: 10px; outline: none; }
        .btn { border: 1px solid #0f0; padding: 15px; background: none; color: #0f0; cursor: pointer; width: 280px; font-weight: bold; text-transform: uppercase; margin: 10px; }
        .btn:hover { background: #0f0; color: #000; }
        #timer { font-size: 3.5rem; color: #ff0; text-shadow: 0 0 15px #f00; font-weight: bold; }
        #question-text { font-size: 1.3rem; padding: 30px; max-width: 800px; line-height: 1.6; min-height: 120px; }
        
        /* New Professional Scorecard Look */
        #result-screen { background: #fff; color: #000; }
        .score-box { border: 2px solid #000; padding: 40px; background: #fff; width: 85%; max-width: 600px; box-shadow: 10px 10px 0px #ccc; }
        .score-val { font-size: 5rem; font-weight: 900; margin: 10px 0; color: #d00; }
        .label { text-transform: uppercase; letter-spacing: 3px; font-weight: bold; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="start-screen" class="screen">
        <h1 style="letter-spacing: 5px; color: #0f0;">3-OVER MATCH</h1>
        <select id="lang-select">
            <option value="en">ENGLISH MODE</option>
            <option value="hi">HINDI MODE (हिन्दी)</option>
        </select>
        <select id="level-select">
            <option value="easy">LEVEL: NOVICE</option>
            <option value="medium">LEVEL: ANALYST</option>
            <option value="hard">LEVEL: EXPERT</option>
        </select>
        <button class="btn" onclick="initMatch()">START MATCH</button>
    </div>

    <div id="game-screen" class="screen hidden">
        <h2 id="over-title" style="color: #8f8;">---</h2>
        <div id="timer">--:--</div>
        <div id="question-box"><p id="question-text">Loading Questions...</p><div id="options"></div></div>
    </div>

    <div id="result-screen" class="screen hidden">
        <div class="score-box">
            <div class="label">Official Scorecard</div>
            <hr>
            <p id="cert-date" style="font-weight: bold;"></p>
            <div class="label">Final Match Points</div>
            <div id="final-stats" class="score-val">0/18</div>
            <p>NISH-LOGIC ANALYTICS ENGINE</p>
            <button class="btn" style="border-color:#000; color:#000;" onclick="downloadPDF()">SAVE SCORECARD PDF</button>
            <button class="btn" style="border-color:#000; color:#000;" onclick="location.reload()">NEW MATCH</button>
        </div>
    </div>

    <script>
        let score = 0, currentQ = 0, timeLeft = 0, timer, questions = [], level = 'easy', lang = 'en';
        const categories = [19, 18, 24]; 
        let audioCtx;

        async function translateText(text) {
            if (lang === 'en') return text;
            try {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=hi&dt=t&q=${encodeURIComponent(text)}`);
                const data = await res.json();
                return data[0][0][0];
            } catch(e) { return text; }
        }

        function playSound(f, t, d) {
            if(!audioCtx) return;
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.type = t; o.frequency.value = f; g.gain.value = 0.05;
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        }

        async function initMatch() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            level = document.getElementById('level-select').value;
            lang = document.getElementById('lang-select').value;
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            await fetchOver();
        }

        async function fetchOver() {
            const idx = Math.floor(currentQ / 6);
            const names = ["OVER 1: APTITUDE (MATHS)", "OVER 2: REASONING (LOGIC)", "OVER 3: GK (CURRENT)"];
            const times = [360, 360, 180];
            document.getElementById('over-title').innerText = await translateText(names[idx]);
            timeLeft = times[idx];
            
            try {
                const r = await fetch(`https://opentdb.com/api.php?amount=6&category=${categories[idx]}&difficulty=${level}&type=multiple`);
                const d = await r.json();
                questions = d.results;
                startTimer();
                showQuestion();
            } catch (e) { setTimeout(fetchOver, 2000); }
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                let m = Math.floor(timeLeft / 60), s = timeLeft % 60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                if(timeLeft % 2 === 0) playSound(60, 'sine', 0.1); 
                if(timeLeft <= 0) endMatch();
            }, 1000);
        }

        async function showQuestion() {
            if (currentQ > 0 && currentQ % 6 === 0) { clearInterval(timer); return fetchOver(); }
            if (currentQ >= 18) return endMatch();

            const q = questions[currentQ % 6];
            document.getElementById('question-text').innerHTML = await translateText(q.question);
            const rawOpts = [...q.incorrect_answers, q.correct_answer].sort(() => Math.random() - 0.5);
            const box = document.getElementById('options'); box.innerHTML = '';
            
            for (let o of rawOpts) {
                const b = document.createElement('button'); b.className = 'btn'; 
                b.innerHTML = await translateText(o);
                b.onclick = () => {
                    playSound(400, 'square', 0.05);
                    if(o === q.correct_answer) score++;
                    currentQ++; showQuestion();
                };
                box.appendChild(b);
            }
        }

        function endMatch() {
            clearInterval(timer);
            document.getElementById('cert-date').innerText = "DATE: " + new Date().toLocaleDateString();
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-stats').innerText = `${score}/18`;
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            doc.setLineWidth(1); doc.rect(10, 10, 190, 277);
            doc.setFont("courier", "bold"); doc.setFontSize(22);
            doc.text("OFFICIAL SCORECARD", 105, 40, { align: "center" });
            doc.setFontSize(12); doc.text(`DATE: ${new Date().toLocaleDateString()}`, 105, 50, { align: "center" });
            doc.line(30, 60, 180, 60);
            doc.setFontSize(16); doc.text("MATCH PERFORMANCE SCORE", 105, 80, { align: "center" });
            doc.setFontSize(60); doc.setTextColor(200, 0, 0);
            doc.text(`${score}/18`, 105, 120, { align: "center" });
            doc.setTextColor(0, 0, 0); doc.setFontSize(10);
            doc.text("NISH-LOGIC APTITUDE ASSESSMENT ENGINE", 105, 140, { align: "center" });
            doc.text(`REF: NL-${Math.random().toString(36).toUpperCase().substr(2, 8)}`, 105, 150, { align: "center" });
            doc.save("Scorecard.pdf");
        }
    </script>
</body>
</html>
