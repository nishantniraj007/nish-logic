<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3-OVER MATCH | PRO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; text-align: center; margin: 0; overflow: hidden; }
        .screen { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .hidden { display: none; }
        .btn { border: 1px solid #0f0; padding: 15px; background: none; color: #0f0; cursor: pointer; margin: 10px; width: 280px; font-weight: bold; }
        .btn:hover { background: #0f0; color: #000; }
        #timer { font-size: 3rem; color: #ff0; text-shadow: 0 0 10px #f00; }
        
        /* Kindle Style Modal */
        #result-screen { background: #f4f4f4; color: #1a1a1a; border: 10px solid #1a1a1a; box-sizing: border-box; }
        .certificate-box { border: 2px solid #1a1a1a; padding: 40px; margin: 20px; max-width: 80%; }
        .kindle-text { font-family: serif; font-style: italic; }
    </style>
</head>
<body>
    <div id="start-screen" class="screen">
        <h1>NISH-LOGIC: 3-OVER MATCH</h1>
        <button class="btn" onclick="startMatch('easy')">START SESSION</button>
    </div>

    <div id="game-screen" class="screen hidden">
        <h2 id="over-title">OVER 1: APTITUDE</h2>
        <div id="timer">60s</div>
        <div id="question-box"><p id="question-text">Syncing...</p><div id="options"></div></div>
    </div>

    <div id="result-screen" class="screen hidden">
        <div class="certificate-box">
            <h1 class="kindle-text">Performance Certificate</h1>
            <hr color="#1a1a1a">
            <p>This document certifies the logical aptitude session completion.</p>
            <h2 id="final-stats">SCORE: 0/18</h2>
            <p class="kindle-text">Verified by Nish-Logic Engine</p>
            <button class="btn" style="border-color:#1a1a1a; color:#1a1a1a;" onclick="downloadPDF()">GENERATE KINDLE PDF</button>
            <button class="btn" style="border-color:#1a1a1a; color:#1a1a1a;" onclick="location.reload()">RETRY</button>
        </div>
    </div>

    <script>
        let score = 0, currentQ = 0, timeLeft = 60, timer, questions = [], level = 'easy';
        const categories = [18, 19, 9];
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(f, t, d) {
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.type = t; o.frequency.value = f; g.gain.value = 0.05;
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        }

        async function startMatch(lvl) {
            level = lvl; audioCtx.resume();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            await fetchOver();
        }

        async function fetchOver() {
            const idx = Math.floor(currentQ / 6);
            try {
                const r = await fetch(`https://opentdb.com/api.php?amount=6&category=${categories[idx]}&difficulty=${level}&type=multiple`);
                const d = await r.json();
                questions = d.results;
                timeLeft = 60;
                startTimer();
                showQuestion();
            } catch (e) { setTimeout(fetchOver, 2000); }
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft + "s";
                if(timeLeft % 2 === 0) playSound(50, 'sine', 0.1);
                if(timeLeft <= 0) endMatch();
            }, 1000);
        }

        function showQuestion() {
            if (currentQ > 0 && currentQ % 6 === 0) { clearInterval(timer); return fetchOver(); }
            if (currentQ >= 18) return endMatch();
            const q = questions[currentQ % 6];
            document.getElementById('question-text').innerHTML = q.question;
            const opts = [...q.incorrect_answers, q.correct_answer].sort(() => Math.random() - 0.5);
            const box = document.getElementById('options'); box.innerHTML = '';
            opts.forEach(o => {
                const b = document.createElement('button'); b.className = 'btn'; b.innerHTML = o;
                b.onclick = () => {
                    playSound(400, 'square', 0.05);
                    if(o === q.correct_answer) score++;
                    currentQ++; showQuestion();
                };
                box.appendChild(b);
            });
        }

        function endMatch() {
            clearInterval(timer);
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-stats').innerText = `FINAL SCORE: ${score}/18`;
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape', 'mm', 'a5');
            doc.setFillColor(244, 244, 244);
            doc.rect(0, 0, 210, 148, 'F');
            doc.setLineWidth(1);
            doc.rect(10, 10, 190, 128); 
            doc.setFont("serif", "italic");
            doc.setFontSize(26);
            doc.text("Certificate of Logic", 105, 40, { align: "center" });
            doc.setFont("courier", "normal");
            doc.setFontSize(14);
            doc.text("This confirms completion of the 3-Over Match", 105, 60, { align: "center" });
            doc.setFontSize(30);
            doc.text(`RESULT: ${score}/18`, 105, 90, { align: "center" });
            doc.setFontSize(10);
            doc.text(`ID: NL-${Math.random().toString(36).substr(2, 9).toUpperCase()}`, 105, 110, { align: "center" });
            doc.save("Nish-Logic-Scorecard.pdf");
        }
    </script>
</body>
</html>
